-- Main user table
CREATE TABLE "user" (
  id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  name TEXT,
  email TEXT UNIQUE NOT NULL,
  email_verified TIMESTAMPTZ,
  image TEXT,
  password_hash TEXT
);

-- Links OAuth providers to a user
CREATE TABLE account (
  id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  user_id BIGINT NOT NULL REFERENCES "user"(id) ON DELETE CASCADE,
  type TEXT NOT NULL,
  provider TEXT NOT NULL,
  provider_account_id TEXT NOT NULL,
  refresh_token TEXT,
  access_token TEXT,
  expires_at BIGINT,
  token_type TEXT,
  scope TEXT,
  id_token TEXT,
  session_state TEXT,
  UNIQUE (provider, provider_account_id)
);

-- Stores user sessions for database session strategy
CREATE TABLE session (
  id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  session_token TEXT UNIQUE NOT NULL,
  user_id BIGINT NOT NULL REFERENCES "user"(id) ON DELETE CASCADE,
  expires TIMESTAMPTZ NOT NULL
);

-- Stores tokens for passwordless email sign-in
CREATE TABLE verification_token (
  identifier TEXT NOT NULL,
  token TEXT NOT NULL UNIQUE,
  expires TIMESTAMPTZ NOT NULL,
  PRIMARY KEY (identifier, token)
);

-- Your custom table for password resets
CREATE TABLE password_reset (
  id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
  user_id BIGINT NOT NULL REFERENCES "user"(id) ON DELETE CASCADE,
  token TEXT NOT NULL UNIQUE,
  expires TIMESTAMPTZ NOT NULL
);

-- Your custom table for lists
CREATE TABLE list (
    id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    title TEXT NOT NULL,
    description TEXT,
    category TEXT NOT NULL,
    user_id BIGINT NOT NULL REFERENCES "user"(id) ON DELETE CASCADE,
    share_id TEXT UNIQUE NOT NULL,
    created_at TIMESTAMPTZ DEFAULT now(),
    active BOOLEAN DEFAULT TRUE
);

CREATE TABLE "product" (
    id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
    list_id BIGINT NOT NULL REFERENCES "list"(id) ON DELETE CASCADE,
    name VARCHAR(100) NOT NULL,
    description VARCHAR(512),
    url TEXT,
    image_url TEXT,
    price DECIMAL(10, 2),
    currency VARCHAR(10) DEFAULT 'BRL' NOT NULL,
    quantity INT DEFAULT 1 NOT NULL,
    purchase_type TEXT NOT NULL, -- 'payment' or 'redirect'
    created_at TIMESTAMPTZ DEFAULT now(),
    is_active BOOLEAN DEFAULT TRUE
);

